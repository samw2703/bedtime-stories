<!--npx serve . to run-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Random Story</title>
  <script src="stories.js"></script>
  <script src="rssFeeds.js"></script>
  <script>
    function setMessage(message) {
      const messageBox = document.getElementById('messageBox');
      if (messageBox) {
        messageBox.textContent = message;
      }
    }

    function clearMessage() {
      setMessage('');
    }

    async function goToRandomThing() {
      window.location.href = await getRandomStoryUrl();
    }

    async function getRandomStoryUrl() {
      const source = getRandomSource();
      return await getRandomUrl(source);
    }

    function getRandomSource() {
      const sources = ["urls", "feed", "feed"];
      return sources[Math.floor(Math.random() * sources.length)];
    } 

    async function getRandomUrl(source) {
      if (source === "urls")
        return pickRandomStory();

      if (source === "feed")
        return await getRandomArticleFromRandomFeed();

      return "";
    }

    async function getRandomArticleFromRandomFeed() {
      const feeds = ['https://feeds.bbci.co.uk/news/rss.xml',
        'https://www.thisiscolossal.com/feed/',
        'https://longreads.com/rss',
        'http://feeds.guardian.co.uk/theguardian/culture/rss',
        'https://www.themarginalian.org/feed/',
        'https://feeds.feedburner.com/oatmealfeed',
        'https://xkcd.com/rss.xml',
        'https://feeds.guardian.co.uk/theguardian/world/rss',
      ];
      const randomFeed = feeds[Math.floor(Math.random() * feeds.length)];

      setMessage(`Fetching article from: ${randomFeed}`);

      try {
        return await getRandomArticle(randomFeed);
      } catch (error) {
        setMessage(`Failed to fetch from RSS feed: ${randomFeed}`);
        throw error;
      }
    }
  </script>
</head>
<body>
  <div id="messageBox" style="
    background-color: #f0f0f0;
    color: #333;
    padding: 1rem;
    text-align: center;
    min-height: 2rem;
    font-size: 1rem;
    border-bottom: 1px solid #ddd;
  "></div>
  <div style="display: flex; justify-content: center; align-items: center; height: calc(100vh - 4rem);">
    <button 
      onclick="goToRandomThing()" 
      style="
        background-color: #28a745;
        color: white;
        font-size: 2rem;
        padding: 1.5rem 3rem;
        border: none;
        border-radius: 2rem;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transition: background 0.2s;
        width: 90vw;
        max-width: 400px;
      ">
      Reading Time!
    </button>
  </div>
  <style>
    @media (max-width: 600px) {
      button {
        font-size: 1.2rem !important;
        padding: 1rem 1.5rem !important;
        border-radius: 1rem !important;
      }
      div {
        height: 80vh !important;
      }
    }
  </style>
</body>
</html>
